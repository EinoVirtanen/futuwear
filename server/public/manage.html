<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta content='width=device-width, height=device-height, initial-scale=1' name='viewport' />
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/futuwear-front.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.6/Chart.bundle.js"></script>

	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
	
	<title>Futuwear</title>
	<style>
		.app {
			max-width:500px;
			padding:2em;
			margin: 0 auto;
		}
	</style>
</head>
<body>
	<div class="app">
		<h3>The Futuwear Portal</h3>
		<br><br><br>
		
		
		<h4>Your sensors</h4>
		<table id="list"><tr><td>No sensors (try adding a device)</td></tr></table>
		<!--<button type="button" class="btn btn-primary">New Sensor</button>-->
		<br><br><hr><br>
		
		
		
		
		<button onclick="login()" class="btn btn-primary">View a device</button>
		
	</div>
	
	
	<script>
	
		function fetch() {
			$.get("/sensors", "", function (res) {
				try {
					var resp = json(res)
					
					if (typeof resp["error"] != "undefined")
						throw new Error(resp["error"])
						
					console.log(JSON.stringify(resp))
					
					$("#list").html("  ")
					for (var i = 0; i < resp.length; i++) {
						var reading = resp[i]
						
						var sensorID = reading["ID"]
						var deviceKey = reading["ownerKey"]
						
						$("#list").append("<tr><td><b>" + sensorID + "</b> ("+reading.collection+" values) </td><td><small>" + deviceKey + " </small></td></tr>")
					}
					
					if (i >= 100) {
						$("#list").append("<tr><td colspan='3'>Some data may have been truncated</td></tr>")
					}
					else if (i <= 0) {
						throw new Error("No sensors could be found");
					}
				} catch (e) {
					console.log("Problem loading sensors: " + e.message)
					$("#list").append("<tr><td colspan='3'>" + e.message + "</td></tr>")
				}
			})
		}
	
		$(document).ready(function () {
			setInterval(function () { fetch() }, 1000)
		})
		
		function login() {
			var uname = prompt("Device name?","proto")
			createCookie("devices", uname, 1)
			location.reload(); 
		}
		
		function logout() {
			removeCookie("devices")
			location.reload(); 
		}

	</script>
</body>
</html>