<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta content='width=device-width, height=device-height, initial-scale=1' name='viewport' />
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="/css/bootstrap.css">
	<title>Futuwear</title>
	<style>
		.app {
			max-width:500px;
			padding:2em;
			margin: 0 auto;
		}
		#stage {
			min-height:2em;
		}
	</style>
</head>
<body>
	<div class="app">
		<h3>The Futuwear Portal</h3>
		<br><br><br><br><br><br>
		<div id="knobs">
		</div>
		<button onclick="fetch()">Refresh</button>
	</div>
	
	<script>
		function fetch() {
			$.get("/fetch", "", function (r) {
				//TODO: Safety
				var sensors = r["sensors"]
				for (var i = 0; i < sensors.length; i++) {
					var sensorName = sensors[i]["name"]
					var dataPoints = sensors[i]["collection"]
					
					var average = dataPoints.reduce(function (prev, curr, i, arr) {
						return prev + curr["value"] / (sensors.length + 1)
					}, 0)
					if ($("#" + sensorName).length <= 0)
						$("#knobs").append("<input type='range' id='" + sensorName + "' min='0' max='1000' value='0'>\n")
					$("#" + sensorName).val(average)
				}				
				
			})
		}
		
		$(document).ready(function () {
			setInterval(function () { fetch() }, 200)
		})
	</script>
</body>
</html>